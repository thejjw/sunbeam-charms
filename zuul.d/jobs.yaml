- job:
    name: charm-build-keystone-k8s
    description: Build sunbeam keystone-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/keystone-k8s/
      - rebuild
    vars:
      charm: keystone-k8s
- job:
    name: charm-build-tempest-k8s
    description: Build sunbeam tempest-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/tempest-k8s/
      - rebuild
    vars:
      charm: tempest-k8s
- job:
    name: charm-build-glance-k8s
    description: Build sunbeam glance-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/glance-k8s/
      - rebuild
    vars:
      charm: glance-k8s
- job:
    name: charm-build-nova-k8s
    description: Build sunbeam nova-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/nova-k8s/
      - rebuild
    vars:
      charm: nova-k8s
- job:
    name: charm-build-placement-k8s
    description: Build sunbeam placement-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/placement-k8s/
      - rebuild
    vars:
      charm: placement-k8s
- job:
    name: charm-build-neutron-k8s
    description: Build sunbeam neutron-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/neutron-k8s/
      - rebuild
    vars:
      charm: neutron-k8s
- job:
    name: charm-build-neutron-baremetal-switch-config-k8s
    description: Build sunbeam neutron-baremetal-switch-config-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/neutron-baremetal-switch-config-k8s/
      - rebuild
    vars:
      charm: neutron-baremetal-switch-config-k8s
- job:
    name: charm-build-neutron-generic-switch-config-k8s
    description: Build sunbeam neutron-generic-switch-config-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/neutron-generic-switch-config-k8s/
      - rebuild
    vars:
      charm: neutron-generic-switch-config-k8s
- job:
    name: charm-build-ovn-central-k8s
    description: Build sunbeam ovn-central-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ovn-central-k8s/
      - rebuild
    vars:
      charm: ovn-central-k8s
- job:
    name: charm-build-ovn-relay-k8s
    description: Build sunbeam ovn-relay-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ovn-relay-k8s/
      - rebuild
    vars:
      charm: ovn-relay-k8s
- job:
    name: charm-build-cinder-k8s
    description: Build sunbeam cinder-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/cinder-k8s/
      - rebuild
    vars:
      charm: cinder-k8s
- job:
    name: charm-build-cinder-volume
    description: Build sunbeam cinder-volume charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/cinder-volume/
      - rebuild
    vars:
      charm: cinder-volume
- job:
    name: charm-build-cinder-volume-ceph
    description: Build sunbeam cinder-volume-ceph charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/storage/cinder-volume-ceph/
      - rebuild
    vars:
      charm: cinder-volume-ceph
      storage: true
- job:
    name: charm-build-cinder-volume-purestorage
    description: Build sunbeam cinder-volume-purestorage charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/storage/cinder-volume-purestorage/
      - rebuild
    vars:
      charm: cinder-volume-purestorage
      storage: true
- job:
    name: charm-build-epa-orchestrator
    description: Build sunbeam epa-orchestrator charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/epa-orchestrator/*
      - rebuild
    vars:
      charm: epa-orchestrator
- job:
    name: charm-build-horizon-k8s
    description: Build sunbeam horizon-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/horizon-k8s/
      - rebuild
    vars:
      charm: horizon-k8s
- job:
    name: charm-build-heat-k8s
    description: Build sunbeam heat-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/heat-k8s/
      - rebuild
    vars:
      charm: heat-k8s
- job:
    name: charm-build-ironic-k8s
    description: Build sunbeam ironic-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ironic-k8s/
      - rebuild
    vars:
      charm: ironic-k8s
- job:
    name: charm-build-ironic-conductor-k8s
    description: Build sunbeam ironic-conductor-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ironic-conductor-k8s/
      - rebuild
    vars:
      charm: ironic-conductor-k8s
- job:
    name: charm-build-nova-ironic-k8s
    description: Build sunbeam nova-ironic-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/nova-ironic-k8s/
      - rebuild
    vars:
      charm: nova-ironic-k8s
- job:
    name: charm-build-octavia-k8s
    description: Build sunbeam octavia-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/octavia-k8s/
      - rebuild
    vars:
      charm: octavia-k8s
- job:
    name: charm-build-aodh-k8s
    description: Build sunbeam aodh-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/aodh-k8s/
      - rebuild
    vars:
      charm: aodh-k8s
- job:
    name: charm-build-ceilometer-k8s
    description: Build sunbeam ceilometer-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ceilometer-k8s/
      - rebuild
    vars:
      charm: ceilometer-k8s
- job:
    name: charm-build-gnocchi-k8s
    description: Build sunbeam gnocchi-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/gnocchi-k8s/
      - rebuild
    vars:
      charm: gnocchi-k8s
- job:
    name: charm-build-barbican-k8s
    description: Build sunbeam barbican-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/barbican-k8s/
      - rebuild
    vars:
      charm: barbican-k8s
- job:
    name: charm-build-magnum-k8s
    description: Build sunbeam magnum-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/magnum-k8s/
      - rebuild
    vars:
      charm: magnum-k8s
- job:
    name: charm-build-manila-k8s
    description: Build sunbeam manila-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/manila-k8s/
      - rebuild
    vars:
      charm: manila-k8s
- job:
    name: charm-build-manila-cephfs-k8s
    description: Build sunbeam manila-cephfs-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/manila-cephfs-k8s/
      - rebuild
    vars:
      charm: manila-cephfs-k8s
- job:
    name: charm-build-manila-data
    description: Build sunbeam manila-data charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/manila-data/
      - rebuild
    vars:
      charm: manila-data
- job:
    name: charm-build-designate-k8s
    description: Build sunbeam designate-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/designate-k8s/
      - rebuild
    vars:
      charm: designate-k8s
- job:
    name: charm-build-designate-bind-k8s
    description: Build sunbeam designate-bind-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/designate-bind-k8s/
      - rebuild
    vars:
      charm: designate-bind-k8s
- job:
    name: charm-build-keystone-ldap-k8s
    description: Build sunbeam keystone-ldap-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/keystone-ldap-k8s/
      - rebuild
    vars:
      charm: keystone-ldap-k8s
- job:
    name: charm-build-keystone-saml-k8s
    description: Build sunbeam keystone-saml-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/keystone-saml-k8s/
      - rebuild
    vars:
      charm: keystone-saml-k8s
- job:
    name: charm-build-openstack-exporter-k8s
    description: Build sunbeam openstack-exporter-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/openstack-exporter-k8s/
      - rebuild
    vars:
      charm: openstack-exporter-k8s
- job:
    name: charm-build-openstack-hypervisor
    description: Build sunbeam openstack-hypervisor charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/openstack-hypervisor/
      - rebuild
    vars:
      charm: openstack-hypervisor
- job:
    name: charm-build-openstack-images-sync-k8s
    description: Build sunbeam openstack-images-sync-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/openstack-images-sync-k8s/
      - rebuild
    vars:
      charm: openstack-images-sync-k8s
- job:
    name: charm-build-sunbeam-machine
    description: Build sunbeam-machine charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/sunbeam-machine/
      - rebuild
    vars:
      charm: sunbeam-machine
- job:
    name: charm-build-sunbeam-clusterd
    description: Build sunbeam-clusterd charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/sunbeam-clusterd/
      - rebuild
    vars:
      charm: sunbeam-clusterd
- job:
    name: charm-build-watcher-k8s
    description: Build sunbeam watcher-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/watcher-k8s/
      - rebuild
    vars:
      charm: watcher-k8s

- job:
    name: charm-build-masakari-k8s
    description: Build sunbeam masakari-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/masakari-k8s/
      - rebuild
    vars:
      charm: masakari-k8s

- job:
    name: charm-build-cloudkitty-k8s
    description: Build sunbeam cloudkitty-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/cloudkitty-k8s/
      - rebuild
    vars:
      charm: cloudkitty-k8s

- job:
    name: charm-build-openstack-network-agents
    description: Build sunbeam openstack-network-agents charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/openstack-network-agents/
      - rebuild
    vars:
      charm: openstack-network-agents

# This test set may be unstable, and more tests need to be added for the tempest-k8s charm,
# so it is only trigger by changes in the tempest-k8s charm and associated tests for now.
# It has been copied from the tests/core charm bundle.
- job:
    name: func-test-tempest
    description: |
      Zaza tests for the tempest-k8s charm.
    timeout: 3600
    pre-run: playbooks/pre-run-func-test.yaml
    run: playbooks/zaza-func-test.yaml
    post-run: playbooks/collect-run-data.yaml
    dependencies:
      - name: charm-build-keystone-k8s
        soft: true
      - name: charm-build-glance-k8s
        soft: true
      - name: charm-build-nova-k8s
        soft: true
      - name: charm-build-placement-k8s
        soft: true
      - name: charm-build-neutron-k8s
        soft: true
      - name: charm-build-ovn-central-k8s
        soft: true
      - name: charm-build-ovn-relay-k8s
        soft: true
      - name: charm-build-tempest-k8s
        soft: true
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/tempest-k8s/
      - tests/local/zaza/sunbeam/charm_tests/tempest_k8s/
      - rebuild
    vars:
      # Artifacts will be downloaded from below charm jobs
      charm_jobs:
        - charm-build-keystone-k8s
        - charm-build-glance-k8s
        - charm-build-nova-k8s
        - charm-build-placement-k8s
        - charm-build-neutron-k8s
        - charm-build-ovn-central-k8s
        - charm-build-ovn-relay-k8s
        - charm-build-tempest-k8s
      # test_dir relative to project src dir
      test_dir: tests/tempest
- job:
    name: func-test-identity
    description: |
      Zaza smoke test for the identity feature, which
      involves keystone and horizon.
    timeout: 3600
    pre-run: playbooks/pre-run-func-test.yaml
    run: playbooks/zaza-func-test.yaml
    post-run: playbooks/collect-run-data.yaml
    dependencies:
      - name: charm-build-keystone-k8s
        soft: true
      - name: charm-build-horizon-k8s
        soft: true
      - name: charm-build-keystone-saml-k8s
        soft: true
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/horizon-k8s/
      - charms/keystone-k8s/
      - charms/keystone-saml-k8s/
      - rebuild
    vars:
      charm_jobs:
        - charm-build-keystone-saml-k8s
        - charm-build-keystone-k8s
        - charm-build-horizon-k8s
      test_dir: tests/identity
- job:
    name: func-test-machine
    description: |
      Zaza smoke test for sunbeam-machine, sunbeam-clusterd charms.
    timeout: 3600
    pre-run: playbooks/pre-run-func-test.yaml
    run: playbooks/zaza-func-test.yaml
    post-run: playbooks/collect-run-data.yaml
    dependencies:
      - name: charm-build-sunbeam-machine
        soft: true
      - name: charm-build-sunbeam-clusterd
        soft: true
      - name: charm-build-epa-orchestrator
        soft: true
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/sunbeam-machine/
      - charms/sunbeam-clusterd/
      - charms/epa-orchestrator/
      - rebuild
    vars:
      env_type: lxd
      charm_jobs:
        - charm-build-sunbeam-machine
        - charm-build-sunbeam-clusterd
        - charm-build-epa-orchestrator
      test_dir: tests/machine

- job:
    name: publish-charm-aodh-k8s
    description: |
      Publish aodh-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/aodh-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-barbican-k8s
    description: |
      Publish barbican-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/barbican-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-ceilometer-k8s
    description: |
      Publish ceilometer-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ceilometer-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-cinder-k8s
    description: |
      Publish cinder-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/cinder-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-cinder-volume
    description: |
      Publish cinder-volume built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/cinder-volume/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-cinder-volume-ceph
    description: |
      Publish cinder-volume-ceph built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/storage/cinder-volume-ceph/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-cinder-volume-purestorage
    description: |
      Publish cinder-volume-purestorage built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/storage/cinder-volume-purestorage/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-epa-orchestrator
    description: |
      Publish epa-orchestrator built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/epa-orchestrator/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-designate-bind-k8s
    description: |
      Publish designate-bind-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/designate-bind-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-designate-k8s
    description: |
      Publish designate-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/designate-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-glance-k8s
    description: |
      Publish glance-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/glance-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-gnocchi-k8s
    description: |
      Publish gnocchi-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/gnocchi-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-heat-k8s
    description: |
      Publish heat-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/heat-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-ironic-k8s
    description: |
      Publish ironic-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ironic-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-ironic-conductor-k8s
    description: |
      Publish ironic-conductor-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ironic-conductor-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-nova-ironic-k8s
    description: |
      Publish nova-ironic-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/nova-ironic-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-horizon-k8s
    description: |
      Publish horizon-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/horizon-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-keystone-k8s
    description: |
      Publish keystone-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/keystone-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-keystone-ldap-k8s
    description: |
      Publish keystone-ldap-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/keystone-ldap-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-keystone-saml-k8s
    description: |
      Publish keystone-saml-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/keystone-saml-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-magnum-k8s
    description: |
      Publish magnum-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/magnum-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-manila-k8s
    description: |
      Publish manila-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/manila-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-manila-cephfs-k8s
    description: |
      Publish manila-cephfs-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/manila-cephfs-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-manila-data
    description: |
      Publish manila-data built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/manila-data/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-neutron-k8s
    description: |
      Publish neutron-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/neutron-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-neutron-baremetal-switch-config-k8s
    description: |
      Publish neutron-baremetal-switch-config-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/neutron-baremetal-switch-config-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-neutron-generic-switch-config-k8s
    description: |
      Publish neutron-generic-switch-config-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/neutron-generic-switch-config-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-nova-k8s
    description: |
      Publish nova-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/nova-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-octavia-k8s
    description: |
      Publish octavia-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/octavia-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-openstack-exporter-k8s
    description: |
      Publish openstack-exporter-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/openstack-exporter-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-openstack-hypervisor
    description: |
      Publish openstack-hypervisor built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/openstack-hypervisor/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-openstack-images-sync-k8s
    description: |
      Publish openstack-images-sync-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/openstack-images-sync-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-ovn-central-k8s
    description: |
      Publish ovn-central-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ovn-central-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-ovn-relay-k8s
    description: |
      Publish ovn-relay-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/ovn-relay-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-placement-k8s
    description: |
      Publish placement-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/placement-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-sunbeam-machine
    description: |
      Publish sunbeam-machine built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/sunbeam-machine/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-sunbeam-clusterd
    description: |
      Publish sunbeam-clusterd built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/sunbeam-clusterd/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-tempest-k8s
    description: |
      Publish tempest-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/tempest-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-watcher-k8s
    description: |
      Publish watcher-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/watcher-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-masakari-k8s
    description: |
      Publish masakari-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/masakari-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-cloudkitty-k8s
    description: |
      Publish cloudkitty-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/cloudkitty-k8s/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-openstack-network-agents
    description: |
      Publish openstack-network-agents built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/openstack-network-agents/
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: func-test-openstack
    description: |
      Zaza smoke test for all the k8s sunbeam charms.
    timeout: 5400
    pre-run: playbooks/pre-run-func-test.yaml
    run: playbooks/zaza-func-test.yaml
    post-run: playbooks/collect-run-data.yaml
    dependencies:
      - name: charm-build-keystone-k8s
        soft: true
      - name: charm-build-glance-k8s
        soft: true
      - name: charm-build-nova-k8s
        soft: true
      - name: charm-build-placement-k8s
        soft: true
      - name: charm-build-neutron-k8s
        soft: true
      - name: charm-build-neutron-baremetal-switch-config-k8s
        soft: true
      - name: charm-build-neutron-generic-switch-config-k8s
        soft: true
      - name: charm-build-openstack-images-sync-k8s
        soft: true
      - name: charm-build-ovn-central-k8s
        soft: true
      - name: charm-build-ovn-relay-k8s
        soft: true
      - name: charm-build-cinder-k8s
        soft: true
      - name: charm-build-gnocchi-k8s
        soft: true
      - name: charm-build-ceilometer-k8s
        soft: true
      - name: charm-build-aodh-k8s
        soft: true
      - name: charm-build-watcher-k8s
        soft: true
      - name: charm-build-heat-k8s
        soft: true
      - name: charm-build-ironic-k8s
        soft: true
      - name: charm-build-ironic-conductor-k8s
        soft: true
      - name: charm-build-nova-ironic-k8s
        soft: true
      - name: charm-build-octavia-k8s
        soft: true
      - name: charm-build-barbican-k8s
        soft: true
      - name: charm-build-magnum-k8s
        soft: true
      - name: charm-build-manila-k8s
        soft: true
      - name: charm-build-manila-cephfs-k8s
        soft: true
      - name: charm-build-manila-data
        soft: true
      - name: charm-build-designate-k8s
        soft: true
      - name: charm-build-designate-bind-k8s
        soft: true
      - name: charm-build-keystone-ldap-k8s
        soft: true
      - name: charm-build-openstack-exporter-k8s
        soft: true
      - name: charm-build-horizon-k8s
        soft: true
      - name: charm-build-masakari-k8s
        soft: true
      - name: charm-build-cloudkitty-k8s
        soft: true
      - name: charm-build-openstack-hypervisor
        soft: true
      - name: charm-build-cinder-volume
        soft: true
      - name: charm-build-cinder-volume-ceph
        soft: true
    files:
      - ops-sunbeam/ops_sunbeam/
      - charms/keystone-k8s/
      - charms/glance-k8s/
      - charms/nova-k8s/
      - charms/neutron-k8s/
      - charms/neutron-baremetal-switch-config-k8s/
      - charms/neutron-generic-switch-config-k8s/
      - charms/placement-k8s/
      - charms/openstack-images-sync-k8s/
      - charms/ovn-central-k8s/
      - charms/ovn-relay-k8s/
      - charms/cinder-k8s/
      - charms/gnocchi-k8s/
      - charms/ceilometer-k8s/
      - charms/aodh-k8s/
      - charms/watcher-k8s/
      - charms/heat-k8s/
      - charms/ironic-k8s/
      - charms/ironic-conductor-k8s/
      - charms/nova-ironic-k8s/
      - charms/octavia-k8s/
      - charms/barbican-k8s/
      - charms/magnum-k8s/
      - charms/manila-k8s/
      - charms/manila-cephfs-k8s/
      - charms/manila-data/
      - charms/designate-k8s/
      - charms/designate-bind-k8s/
      - charms/keystone-ldap-k8s/
      - charms/openstack-exporter-k8s/
      - charms/horizon-k8s/
      - charms/masakari-k8s/
      - charms/cloudkitty-k8s/
      - charms/openstack-hypervisor/
      - charms/cinder-volume/
      - charms/storage/cinder-volume-ceph/
      - rebuild
    vars:
      # Artifacts will be downloaded from below charm jobs
      charm_jobs:
        - charm-build-keystone-k8s
        - charm-build-glance-k8s
        - charm-build-nova-k8s
        - charm-build-placement-k8s
        - charm-build-neutron-k8s
        - charm-build-neutron-baremetal-switch-config-k8s
        - charm-build-neutron-generic-switch-config-k8s
        - charm-build-openstack-images-sync-k8s
        - charm-build-ovn-central-k8s
        - charm-build-ovn-relay-k8s
        - charm-build-cinder-k8s
        - charm-build-gnocchi-k8s
        - charm-build-ceilometer-k8s
        - charm-build-aodh-k8s
        - charm-build-watcher-k8s
        - charm-build-heat-k8s
        - charm-build-ironic-k8s
        - charm-build-ironic-conductor-k8s
        - charm-build-nova-ironic-k8s
        - charm-build-octavia-k8s
        - charm-build-barbican-k8s
        - charm-build-magnum-k8s
        - charm-build-manila-k8s
        - charm-build-manila-cephfs-k8s
        - charm-build-manila-data
        - charm-build-designate-k8s
        - charm-build-designate-bind-k8s
        - charm-build-keystone-ldap-k8s
        - charm-build-openstack-exporter-k8s
        - charm-build-horizon-k8s
        - charm-build-masakari-k8s
        - charm-build-cloudkitty-k8s
        - charm-build-openstack-hypervisor
        - charm-build-cinder-volume
        - charm-build-cinder-volume-ceph
      # test_dir relative to project src dir
      test_dir: tests/openstack
