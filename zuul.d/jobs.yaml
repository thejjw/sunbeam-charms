- job:
    name: charm-build-keystone-k8s
    description: Build sunbeam keystone-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/keystone-k8s/*
      - rebuild
    vars:
      charm: keystone-k8s
- job:
    name: charm-build-glance-k8s
    description: Build sunbeam glance-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/glance-k8s/*
      - rebuild
    vars:
      charm: glance-k8s
- job:
    name: charm-build-nova-k8s
    description: Build sunbeam nova-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/nova-k8s/*
      - rebuild
    vars:
      charm: nova-k8s
- job:
    name: charm-build-placement-k8s
    description: Build sunbeam placement-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/placement-k8s/*
      - rebuild
    vars:
      charm: placement-k8s
- job:
    name: charm-build-neutron-k8s
    description: Build sunbeam neutron-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/neutron-k8s/*
      - rebuild
    vars:
      charm: neutron-k8s
- job:
    name: charm-build-ovn-central-k8s
    description: Build sunbeam ovn-central-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/ovn-central-k8s/*
      - rebuild
    vars:
      charm: ovn-central-k8s
- job:
    name: charm-build-ovn-relay-k8s
    description: Build sunbeam ovn-relay-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/ovn-relay-k8s/*
      - rebuild
    vars:
      charm: ovn-relay-k8s
- job:
    name: charm-build-cinder-k8s
    description: Build sunbeam cinder-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/cinder-k8s/*
      - rebuild
    vars:
      charm: cinder-k8s
- job:
    name: charm-build-cinder-ceph-k8s
    description: Build sunbeam cinder-ceph-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/cinder-ceph-k8s/*
      - rebuild
    vars:
      charm: cinder-ceph-k8s
- job:
    name: charm-build-horizon-k8s
    description: Build sunbeam horizon-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/horizon-k8s/*
      - rebuild
    vars:
      charm: horizon-k8s
- job:
    name: charm-build-heat-k8s
    description: Build sunbeam heat-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/heat-k8s/*
      - rebuild
    vars:
      charm: heat-k8s
- job:
    name: charm-build-octavia-k8s
    description: Build sunbeam octavia-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/octavia-k8s/*
      - rebuild
    vars:
      charm: octavia-k8s
- job:
    name: charm-build-aodh-k8s
    description: Build sunbeam aodh-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/aodh-k8s/*
      - rebuild
    vars:
      charm: aodh-k8s
- job:
    name: charm-build-ceilometer-k8s
    description: Build sunbeam ceilometer-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/ceilometer-k8s/*
      - rebuild
    vars:
      charm: ceilometer-k8s
- job:
    name: charm-build-gnocchi-k8s
    description: Build sunbeam gnocchi-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/gnocchi-k8s/*
      - rebuild
    vars:
      charm: gnocchi-k8s
- job:
    name: charm-build-barbican-k8s
    description: Build sunbeam barbican-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/barbican-k8s/*
      - rebuild
    vars:
      charm: barbican-k8s
- job:
    name: charm-build-magnum-k8s
    description: Build sunbeam magnum-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/magnum-k8s/*
      - rebuild
    vars:
      charm: magnum-k8s
- job:
    name: charm-build-designate-k8s
    description: Build sunbeam designate-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/designate-k8s/*
      - rebuild
    vars:
      charm: designate-k8s
- job:
    name: charm-build-designate-bind-k8s
    description: Build sunbeam designate-bind-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/designate-bind-k8s/*
      - rebuild
    vars:
      charm: designate-bind-k8s
- job:
    name: charm-build-keystone-ldap-k8s
    description: Build sunbeam keystone-ldap-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/keystone-ldap-k8s/*
      - rebuild
    vars:
      charm: keystone-ldap-k8s
- job:
    name: charm-build-openstack-exporter-k8s
    description: Build sunbeam openstack-exporter-k8s charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/openstack-exporter-k8s/*
      - rebuild
    vars:
      charm: openstack-exporter-k8s
- job:
    name: charm-build-openstack-hypervisor
    description: Build sunbeam openstack-hypervisor charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/openstack-hypervisor/*
      - rebuild
    vars:
      charm: openstack-hypervisor
- job:
    name: charm-build-sunbeam-machine
    description: Build sunbeam-machine charm
    run: playbooks/charm/build.yaml
    timeout: 3600
    match-on-config-updates: false
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/sunbeam-machine/*
      - rebuild
    vars:
      charm: sunbeam-machine

- job:
    name: func-test-core
    description: |
      Zaza smoke test for all the core sunbeam charms.
    timeout: 3600
    run: playbooks/zaza-func-test.yaml
    post-run: playbooks/collect-run-data.yaml
    dependencies:
      - name: charm-build-keystone-k8s
        soft: true
      - name: charm-build-glance-k8s
        soft: true
      - name: charm-build-nova-k8s
        soft: true
      - name: charm-build-placement-k8s
        soft: true
      - name: charm-build-neutron-k8s
        soft: true
      - name: charm-build-ovn-central-k8s
        soft: true
      - name: charm-build-ovn-relay-k8s
        soft: true
      - name: charm-build-horizon-k8s
        soft: true
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/keystone-k8s/*
      - charms/glance-k8s/*
      - charms/nova-k8s/*
      - charms/neutron-k8s/*
      - charms/placement-k8s/*
      - charms/ovn-central-k8s/*
      - charms/ovn-relay-k8s/*
      - charms/horizon-k8s/*
      - rebuild
    vars:
      # Artifacts will be downloaded from below charm jobs
      charm_jobs:
        - charm-build-keystone-k8s
        - charm-build-glance-k8s
        - charm-build-nova-k8s
        - charm-build-placement-k8s
        - charm-build-neutron-k8s
        - charm-build-ovn-central-k8s
        - charm-build-ovn-relay-k8s
        - charm-build-horizon-k8s
      # test_dir relative to project src dir
      test_dir: tests/core
- job:
    name: func-test-ceph
    description: |
      Zaza smoke test for all the sunbeam charms that
      requires storage/ceph.
    timeout: 3600
    run: playbooks/zaza-func-test.yaml
    post-run: playbooks/collect-run-data.yaml
    dependencies:
      - name: charm-build-cinder-k8s
        soft: true
      - name: charm-build-cinder-ceph-k8s
        soft: true
      - name: charm-build-gnocchi-k8s
        soft: true
      - name: charm-build-ceilometer-k8s
        soft: true
      - name: charm-build-aodh-k8s
        soft: true
      - name: charm-build-keystone-k8s
        soft: true
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/cinder-k8s/*
      - charms/cinder-ceph-k8s/*
      - charms/gnocchi-k8s/*
      - charms/ceilometer-k8s/*
      - charms/aodh-k8s/*
      - rebuild
    vars:
      charm_jobs:
        - charm-build-cinder-k8s
        - charm-build-cinder-ceph-k8s
        - charm-build-gnocchi-k8s
        - charm-build-ceilometer-k8s
        - charm-build-aodh-k8s
        - charm-build-keystone-k8s
      test_dir: tests/ceph
- job:
    name: func-test-caas
    description: |
      Zaza smoke test for magnum and dependent charms
      like heat, octavia, barbican.
    timeout: 3600
    run: playbooks/zaza-func-test.yaml
    post-run: playbooks/collect-run-data.yaml
    dependencies:
      - name: charm-build-heat-k8s
        soft: true
      - name: charm-build-octavia-k8s
        soft: true
      - name: charm-build-barbican-k8s
        soft: true
      - name: charm-build-magnum-k8s
        soft: true
      - name: charm-build-keystone-k8s
        soft: true
      - name: charm-build-glance-k8s
        soft: true
      - name: charm-build-ovn-central-k8s
        soft: true
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/heat-k8s/*
      - charms/octavia-k8s/*
      - charms/barbican-k8s/*
      - charms/magnum-k8s/*
      - rebuild
    vars:
      charm_jobs:
        - charm-build-heat-k8s
        - charm-build-octavia-k8s
        - charm-build-barbican-k8s
        - charm-build-magnum-k8s
        - charm-build-keystone-k8s
        - charm-build-glance-k8s
        - charm-build-ovn-central-k8s
      test_dir: tests/caas
- job:
    name: func-test-misc
    description: |
      Zaza smoke test for designate, desginate-bind,
      keystone-ldap, openstack-exporter charms.
    timeout: 3600
    run: playbooks/zaza-func-test.yaml
    post-run: playbooks/collect-run-data.yaml
    dependencies:
      - name: charm-build-designate-k8s
        soft: true
      - name: charm-build-designate-bind-k8s
        soft: true
      - name: charm-build-keystone-k8s
        soft: true
      - name: charm-build-keystone-ldap-k8s
        soft: true
      - name: charm-build-openstack-exporter-k8s
        soft: true
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/designate-k8s/*
      - charms/designate-bind-k8s/*
      - charms/keystone-ldap-k8s/*
      - charms/openstack-exporter-k8s/*
      - rebuild
    vars:
      charm_jobs:
        - charm-build-designate-k8s
        - charm-build-designate-bind-k8s
        - charm-build-keystone-ldap-k8s
        - charm-build-openstack-exporter-k8s
        - charm-build-keystone-k8s
      test_dir: tests/misc

- job:
    name: publish-charm-aodh-k8s
    description: |
      Publish aodh-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/aodh-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-barbican-k8s
    description: |
      Publish barbican-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/barbican-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-ceilometer-k8s
    description: |
      Publish ceilometer-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/ceilometer-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-cinder-ceph-k8s
    description: |
      Publish cinder-ceph-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/cinder-ceph-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-cinder-k8s
    description: |
      Publish cinder-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/cinder-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-designate-bind-k8s
    description: |
      Publish designate-bind-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/designate-bind-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-designate-k8s
    description: |
      Publish designate-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/designate-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-glance-k8s
    description: |
      Publish glance-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/glance-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-gnocchi-k8s
    description: |
      Publish gnocchi-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/gnocchi-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-heat-k8s
    description: |
      Publish heat-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/heat-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-horizon-k8s
    description: |
      Publish horizon-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/horizon-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-keystone-k8s
    description: |
      Publish keystone-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/keystone-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-keystone-ldap-k8s
    description: |
      Publish keystone-ldap-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/keystone-ldap-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-magnum-k8s
    description: |
      Publish magnum-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/magnum-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-neutron-k8s
    description: |
      Publish neutron-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/neutron-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-nova-k8s
    description: |
      Publish nova-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/nova-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-octavia-k8s
    description: |
      Publish octavia-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/octavia-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-openstack-exporter-k8s
    description: |
      Publish openstack-exporter-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/openstack-exporter-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-openstack-hypervisor
    description: |
      Publish openstack-hypervisor built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/openstack-hypervisor/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-ovn-central-k8s
    description: |
      Publish ovn-central-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/ovn-central-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-ovn-relay-k8s
    description: |
      Publish ovn-relay-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/ovn-relay-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-placement-k8s
    description: |
      Publish placement-k8s built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/placement-k8s/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600

- job:
    name: publish-charm-sunbeam-machine
    description: |
      Publish sunbeam-machine built in gate pipeline.
    run: playbooks/charm/publish.yaml
    files:
      - ops-sunbeam/ops_sunbeam/*
      - charms/sunbeam-machine/*
      - rebuild
    secrets:
      - charmhub_token
    timeout: 3600
