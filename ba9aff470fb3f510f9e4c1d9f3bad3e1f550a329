{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "593ef7e7_f925aa7f",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 123,
      "author": {
        "id": 10366
      },
      "writtenOn": "2024-02-07T02:29:48Z",
      "side": 1,
      "message": "The cron job configuration is called at configure_unit() and only applied only if an event is emitted (that calls callback configure_charm) after all the validations are successful.\n\nSome of the validations are part of post_config and others are optional relations readiness. So to me the cron job configuration seems more like post_config step rather than configure_unit step.\nThoughts?",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f68f946_a5b3475e",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 123,
      "author": {
        "id": 34352
      },
      "writtenOn": "2024-02-07T04:01:24Z",
      "side": 1,
      "message": "Do you mean to suggest moving it from container_configs to explicitly templating out from post_config?\n\nI don\u0027t think it should matter much either way, since the file will only ever change if the user changes the schedule config, which will launch the hook.  This way we can hook into the existing behaviour for templating and it seems to work fine.",
      "parentUuid": "593ef7e7_f925aa7f",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab6170d0_c46bb731",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 123,
      "author": {
        "id": 10366
      },
      "writtenOn": "2024-02-07T04:25:40Z",
      "side": 1,
      "message": "What happens if the config is set as part of charm deploy?",
      "parentUuid": "7f68f946_a5b3475e",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c46097f3_2edee1e8",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 123,
      "author": {
        "id": 34352
      },
      "writtenOn": "2024-02-07T04:47:31Z",
      "side": 1,
      "message": "hmm that\u0027s a good point.  I\u0027ll check",
      "parentUuid": "ab6170d0_c46bb731",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7df29dd5_8c5a163f",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 223,
      "author": {
        "id": 10366
      },
      "writtenOn": "2024-02-07T02:29:48Z",
      "side": 1,
      "message": "Need a check if the unit is leader",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96227816_55298ce6",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 223,
      "author": {
        "id": 34352
      },
      "writtenOn": "2024-02-07T04:01:24Z",
      "side": 1,
      "message": "Ah good catch, thanks.  This charm isn\u0027t going to support more than one unit though.  Is it possible to either:\n\n- enforce only ever a single unit\n- set a key that\u0027s local to the unit (instead of leader_set)?",
      "parentUuid": "7df29dd5_8c5a163f",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f626f3d2_a6f32bc3",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 223,
      "author": {
        "id": 10366
      },
      "writtenOn": "2024-02-07T04:25:40Z",
      "side": 1,
      "message": "* enforce only ever a single unit\n\nwe discussed this in other PR, we can block the non-leader units during configure_app_non_leader() with appropriate message. At this point of time post-config is not run so tempest-init is not executed.\n\n* set a key that\u0027s local to the unit (instead of leader_set)?\nYes updating a unit data bag will be more appropriate as tempest-init is something local to unit and not for app.",
      "parentUuid": "96227816_55298ce6",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "33510843_7df6e2a8",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 223,
      "author": {
        "id": 34352
      },
      "writtenOn": "2024-02-07T04:47:31Z",
      "side": 1,
      "message": "Ok, so no way to enforce a single unit, but we can enforce the other units to be no-op units.  That should work, thanks.  It might be better to implement that in a separate patch, because it will touch more than just the tempest init parts.\n\n\u003e updating a unit data bag will be more appropriate\n\nAh cool!  Could you point me to how I can do this?  I did search through the code but the best I could find was leader_set.",
      "parentUuid": "f626f3d2_a6f32bc3",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6d3256d_2297bce6",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 223,
      "author": {
        "id": 10366
      },
      "writtenOn": "2024-02-07T05:20:58Z",
      "side": 1,
      "message": "https://opendev.org/openstack/sunbeam-charms/src/branch/main/ops-sunbeam/ops_sunbeam/interfaces.py#L147\n\nhttps://opendev.org/openstack/sunbeam-charms/src/branch/main/charms/heat-k8s/src/charm.py#L286",
      "parentUuid": "33510843_7df6e2a8",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "06bd88d0_41517bb4",
        "filename": "charms/tempest-k8s/src/charm.py",
        "patchSetId": 13
      },
      "lineNbr": 223,
      "author": {
        "id": 34352
      },
      "writtenOn": "2024-02-07T06:07:51Z",
      "side": 1,
      "message": "Thanks!  Updated to use unit data instead.  We have a ticket internally to sort out leader/non-leader logic. ðŸ˜Š",
      "parentUuid": "a6d3256d_2297bce6",
      "revId": "ba9aff470fb3f510f9e4c1d9f3bad3e1f550a329",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    }
  ]
}