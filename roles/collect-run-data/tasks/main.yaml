- name: test runner packages are installed
  apt:
    name:
      - jq
  become: true
- name: nftables is installed
  apt:
    name: nftables
  become: true
  when: ansible_distribution_release == 'jammy'
- name: nftables list
  command:
    nft list ruleset
  register: nft_result
  become: true
- name: unbound
  command:
    cat /etc/unbound/forwarding.conf
  register: unbound_conf
  become: true
- name: resolv conf
  command:
    cat /etc/resolv.conf
  register: resolv_conf
  become: true
- name: resolvectl
  command:
    resolvectl status
  register: resolv_ctl
  become: true


- name: Create destination for logs
  file:
    path: "{{ zuul.project.src_dir }}/log"
    state: directory
    mode: 0755
- name: Include k8s tasks
  include_tasks: k8s.yaml
  when: env_type == 'k8s'
- name: fetch juju logs
  synchronize:
    dest: "{{ zuul.executor.log_root }}"
    mode: pull
    src: "{{ zuul.project.src_dir }}/log"
    verify_host: true
    owner: false
    group: false
