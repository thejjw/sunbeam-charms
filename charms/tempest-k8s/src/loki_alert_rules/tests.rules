groups:
- name: tempest-failed-tests
  rules:
  - alert: FailedTests
    expr: 'last_over_time({filename="/var/lib/tempest/workspace/tempest-periodic.log",
      %%juju_topology%%} |~ "- Failed:" | pattern " - <_>: <number_of_tests>" | unwrap
      number_of_tests [719h]) > 0'
    labels:
      severity: high
  - alert: AbsentTests
    annotations:
      summary: Tempest periodic tests not seen recently
    expr: absent_over_time({filename="/var/lib/tempest/workspace/tempest-periodic.log",
      %%juju_topology%%} |~ "- Failed:" [2]) == 1
    labels:
      severity: high
