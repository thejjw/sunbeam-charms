{% if fid and fid.oidc_providers %}
    OIDCClaimPrefix "OIDC-"
    OIDCClaimDelimiter ";"
    OIDCResponseType code
    OIDCScope "openid email profile"
    OIDCStateInputHeaders none
    OIDCXForwardedHeaders X-Forwarded-Proto X-Forwarded-Host X-Forwarded-Port
    OIDCSessionType client-cookie:persistent
    OIDCCryptoPassphrase {{ fid.oidc_crypto_passphrase }}
    OIDCMetadataDir /etc/apache2/oidc-metadata
    OIDCRedirectURI {{ fid.redirect_uri }}

    <Location {{ fid.redirect_uri_path }}>
       AuthType auth-openidc
       Require valid-user
    </Location>

{% for provider in fid.oidc_providers %}
    <Location {{fid.public_url_path}}/OS-FEDERATION/identity_providers/{{ provider.name }}/protocols/{{ provider.protocol }}/auth>
        AuthType auth-openidc
        Require valid-user

        OAuth2TokenVerify jwks_uri {{provider.jwks_endpoint}}
        Require claim iss:{{provider.issuer_url}}
        SetEnv HTTP_OIDC_ISS {{provider.issuer_url}}
    </Location>

    <Location {{fid.public_url_path}}/auth/OS-FEDERATION/identity_providers/{{ provider.name }}/protocols/{{ provider.protocol }}/websso>
        Require valid-user
        AuthType openid-connect

        OIDCDiscoverURL {{ fid.redirect_uri }}?iss={{provider.encoded_issuer_url}}
        Require claim iss:{{provider.issuer_url}}
    </Location>
{% endfor %}
{% endif %}
