{% if oauth and oauth.oidc_providers -%}
    OIDCClaimPrefix "OIDC-"
    OIDCClaimDelimiter ";"
    OIDCResponseType code
    OIDCScope "openid email profile"
    OIDCStateInputHeaders none
    OIDCXForwardedHeaders X-Forwarded-Proto X-Forwarded-Host X-Forwarded-Port
    OIDCSessionType client-cookie:persistent
    OIDCCryptoPassphrase {{ oauth.oidc_crypto_passphrase }}
    OIDCMetadataDir /etc/apache2/oidc-metadata
    OIDCRedirectURI {{ oauth.redirect_uri }}


    <Location {{ oauth.redirect_uri_path }}>
       AuthType auth-openidc
       Require valid-user
    </Location>

{% for provider in oauth.oidc_providers -%}

    <Location {{oauth.public_url_path}}/OS-FEDERATION/identity_providers/{{ provider.name }}/protocols/{{ provider.protocol }}/auth>
        AuthType auth-openidc
        Require valid-user

        OAuth2TokenVerify jwks_uri {{provider.info.jwks_endpoint}}
        Require claim iss:{{provider.info.issuer_url}}
        SetEnv HTTP_OIDC_ISS {{provider.info.issuer_url}}
    </Location>

    <Location {{oauth.public_url_path}}/auth/OS-FEDERATION/identity_providers/{{ provider.name }}/protocols/{{ provider.protocol }}/websso>
        Require valid-user
        AuthType openid-connect

        OIDCDiscoverURL {{ oauth.redirect_uri }}?iss={{provider.encoded_issuer_url}}
        Require claim iss:{{provider.info.issuer_url}}
    </Location>

{% endfor -%}
{% endif -%}
